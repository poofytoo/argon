<html>
  <head>
    <script type='text/javascript' src='https://cdn.firebase.com/v0/firebase.js'></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script type='text/javascript'>
      var myDataRef = new Firebase('https://banker.firebaseio.com');
      
      //finds the next empty seat in a room
      function getEmptySeat(room) {
        for (i = 1; i < 5; i ++){
          console.log(room["player"+i]);
          if (room["player"+i] == "none"){
            return i
          }
        }
        return false
      }
      
      //check if room is full
      function checkRoomFull(room) {
        for (i = 1; i < 5; i ++){
          if (room["player"+i] == "none"){
            return false;
          }
        }
        return true;
      }
      
      //returns the number of players left
      function getPlayersLeft(room) {
        k = 0;
        for (i = 1; i < 5; i ++){
          if (room["player"+i] == "none"){
            k++;
          }
        }
        return k;
      }
      
      //connect to a room
      var roomData = new Firebase('https://banker.firebaseio.com/roomData');
      roomData.once('value', function(snapshot) {
        room = snapshot.val();
        playerID = getEmptySeat(room);
        if (playerID != false){
          $("#messagebox").append("you are PLAYER" + playerID + "<br />Waiting for players...<br />");
          roomData.child('player'+playerID).set('True');
        } else {
          alert("all seats are full in this room");
        }
      });
      
      //listener- anytime any value of the database is changed
      roomData.on('value', function(snapshot){
        room = snapshot.val()
        $("#messagebox").append("WAITING FOR " + getPlayersLeft(room) + " PLAYERS<br />");
        
        //if the room is full
        if(checkRoomFull(room)){
          $("#messagebox").append("game's starting, bro");
        }
      });
      
      //detect if a person leaves the room.
      window.onbeforeunload = function (e) {
          e = e || window.event;
          var closingMessage = 'Closing this window will likely cause you cancer';
          if (playerID != false){
            roomData.child('player'+playerID).set('none');
          }
          if (e) {
            e.returnValue = closingMessage;
          }
          return closingMessage;
      };
      
    </script>
  </head>
  <body>
    <div id='messagebox'></div>
    <div id='inputbox'>
    	<input type='text' />
    	<input type='button' />
    </div>
  </body>
</html>